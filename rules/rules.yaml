version: "1.1.0"

dataset:
  name: "synthetic_orders"
  path: "data/output/raw.csv"
  primary_key: "order_id"
  timestamps:
    event_ts: "order_ts_utc"
    ingest_ts: "ingested_ts_utc"

scoring:
  weights:
    completeness: 0.30
    validity: 0.35
    uniqueness: 0.20
    timeliness: 0.15

rules:
  - id: "uniq_order_id"
    dimension: "uniqueness"
    type: "unique"
    column: "order_id"
    severity: "high"

  - id: "req_order_ts"
    dimension: "completeness"
    type: "not_null"
    column: "order_ts_utc"
    severity: "high"

  - id: "req_ingested_ts"
    dimension: "completeness"
    type: "not_null"
    column: "ingested_ts_utc"
    severity: "high"

  - id: "req_channel"
    dimension: "completeness"
    type: "not_null"
    column: "channel"
    severity: "medium"

  - id: "req_country"
    dimension: "completeness"
    type: "not_null"
    column: "country"
    severity: "medium"

  - id: "req_email"
    dimension: "completeness"
    type: "not_null"
    column: "email"
    severity: "medium"

  - id: "val_channel_set"
    dimension: "validity"
    type: "in_set"
    column: "channel"
    params:
      allowed: ["web", "ebay", "amazon"]
    severity: "high"

  - id: "val_country_set"
    dimension: "validity"
    type: "in_set"
    column: "country"
    params:
      allowed: ["CA", "US"]
    severity: "high"

  - id: "val_currency_set"
    dimension: "validity"
    type: "in_set"
    column: "currency"
    params:
      allowed: ["CAD", "USD"]
    severity: "high"

  - id: "val_email_regex"
    dimension: "validity"
    type: "regex"
    column: "email"
    params:
      pattern: "^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$"
    severity: "high"

  - id: "val_postal_regex"
    dimension: "validity"
    type: "regex"
    column: "postal_code"
    params:
      pattern: "^(?:[A-Z]\\d[A-Z]\\s?\\d[A-Z]\\d|\\d{5})$"
      flags: "I"
    severity: "medium"

  - id: "val_quantity_range"
    dimension: "validity"
    type: "range"
    column: "quantity"
    params:
      min: 1
      max: 50
    severity: "high"

  - id: "val_unit_price_non_negative"
    dimension: "validity"
    type: "range"
    column: "unit_price"
    params:
      min: 0.01
      max: 10000
    severity: "high"

  - id: "val_discount_pct_range"
    dimension: "validity"
    type: "range"
    column: "discount_pct"
    params:
      min: 0.0
      max: 0.70
    severity: "medium"

  - id: "val_order_total_non_negative"
    dimension: "validity"
    type: "range"
    column: "order_total"
    params:
      min: 0.0
      max: 100000
    severity: "high"

  - id: "time_ingest_lag_hours"
    dimension: "timeliness"
    type: "max_lag_hours"
    params:
      event_ts: "order_ts_utc"
      ingest_ts: "ingested_ts_utc"
      max_hours: 48
    severity: "medium"

dashboard:

  suggested_slices:
    - ["channel"]
    - ["country", "region"]
    - ["order_status"]
    - ["shipping_method"]
  suggested_metrics:
